本文描述 mysql 中数据是如何在磁盘中存储的.

# record

# page

# 表空间

每一个表对应一个表空间, 每个独立表空间在磁盘上对应一个后缀为 `.ibd` 的文件. 该文件存储了表相关的所有内容,包括数据, 索引等.
表空间实际上是一种磁盘空间的管理机制, 因为在进行数据的增,删,改,查的时候, 免不了要对磁盘进行操作, 因此需要有一套完善的磁盘空间管理系统, 能够高效,清晰的管理磁盘页.

## 区

文件中连续的 64 页称为区. 区有什么用呢?
如果没有区, 当我们需要一个页的时候, 直接在表空间中分配一个空闲的页就可以了. 这似乎没什么问题. 但是, 考虑一下 mysql 内部是怎么查找数据的. 先尽可能通过索引定位到第一条记录, 然后依次遍历
每一条记录, 直到记录不满足查询条件. 这里面就涉及到页的遍历了, 如果这也页都是随机分配的, 在磁盘上相距比较远, 就会引入大量的随机 I/O, 从而影响整个系统的性能.

如果有了区, 当我们需要分配页的时候, 就从区里面分配, 这样区里面的页尽可能的近, 能够**尽量降低**随机 I/O 带来的影响.

## 段

段是区的集合. 有了区为什么还需要段呢?
我们说通过区分配页是为了让页之间尽可能的近, 但并是让任意的两个页都尽可能的近, 如果两个页基本不存在连续的访问, 让这两个页近是没有意义的. 所以我们应该让那些大概率会连续访问的页尽可能的近.
我们把这些大概率会连续访问的页称为一类页.
当我们分配页的时候, 怎么知道应该使用哪个区来分配呢? 显然需要将该类页对应的区统一管理, 这样就能获取到正确的区, 而这就是段存在的意义.

总结就是段用来管理若干区.

在 mysql 中, 一个索引的所有叶节点对应一个段, 非叶子节点对应一个段, 所以一个索引对应两个段. 当然, 除了用户数据外, 其他一些信息的存储也会用到段,比如 undo 日志对应的回滚段. 本质上来说, 大概率连续访问的页都应该放到一个段里面.



